/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
#include "DFPlayer_driver.h"
#include "ASCLIN_UART.h"
#include "Bsp.h"
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
void MP3_send_cmd (uint8 cmd, uint16 param)
{
    uint8 mp3_cmd_buf[10];
    uint16 checksum;
    mp3_cmd_buf[0] = 0x7E;
    mp3_cmd_buf[1] = 0xFF;
    mp3_cmd_buf[2] = 0x06;
    mp3_cmd_buf[3] = cmd;
    mp3_cmd_buf[4] = 0x00;
    mp3_cmd_buf[5] = (param >> 8);
    mp3_cmd_buf[6] = (param & 0xFF);
    checksum = 0xFFFF - (mp3_cmd_buf[1] + mp3_cmd_buf[2] + mp3_cmd_buf[3] + mp3_cmd_buf[4] + mp3_cmd_buf[5] + mp3_cmd_buf[6]) + 1;
    mp3_cmd_buf[7] = (checksum >> 8);
    mp3_cmd_buf[8] = (checksum & 0xFF);
    mp3_cmd_buf[9] = 0xEF;

    send_UART_Message_To_MP3(mp3_cmd_buf);
}

// 전원 대기 함수
void waitForPowerOn() {
    // DFPlayer 초기화 대기 시간: 3초
    waitTime(300000000);
}

// DFPlayer 초기화 명령 전송
void sendInitCommand() {
    MP3_send_cmd(0x3F, 0x0000);
}

// DFPlayer 초기화
void initializeDFPlayer() {
    // 전원 대기
    waitForPowerOn();

    // 초기화 명령 전송
    sendInitCommand();

    // 초기화 명령 이후 대기 (응답 처리 시간)
    waitTime(100000000);
}
/*********************************************************************************************************************/
